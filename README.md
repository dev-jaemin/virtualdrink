# Soolther Town

# π™‹β€β™‚οΈκ°λ°ν• μ‚¬λ

- [κΉ€μ¬λ―Ό](https://github.com/dev-jaemin) | κ³ λ ¤λ€ν•™κµ μ»΄ν“¨ν„°ν•™κ³Ό 18ν•™λ²
- [μ΅°μμ§„](https://github.com/Yejin427) | ν•μ–‘λ€ν•™κµ μ»΄ν“¨ν„°μ†ν”„νΈμ›¨μ–΄ν•™λ¶€ 20ν•™λ²
- [κµ¬λ―Όμ¬](https://github.com/9mande) | KAIST μ „μ‚°ν•™λ¶€ 19ν•™λ²


# πμ„λΉ„μ¤ μ†κ°


2D λ©”νƒ€λ²„μ¤ μ„λΉ„μ¤μΈ [Gather.town](http://Gather.town) μ νμ‹μ© λ²„μ „μ…λ‹λ‹¤.

webRTC ν†µμ‹ μ„ μ‚¬μ©ν•μ—¬ μ‹¤μ‹κ°„μΌλ΅ ν™”μƒ ν†µν™”λ¥Ό ν•  μ μμµλ‹λ‹¤.

λν•, μ μ €λΌλ¦¬ μ±„ν…μ΄ κ°€λ¥ν•κ³ , μ±„ν…μ„ ν™μ©ν• 4κ°€μ§€μ μ  κ²μ„λ„ κµ¬ν„ν–μµλ‹λ‹¤.
![intro](https://user-images.githubusercontent.com/43535460/182182025-08c19d51-6128-416c-acec-99d68b881e4f.gif)
![info](https://user-images.githubusercontent.com/43535460/182182053-5749e1f6-67d2-420d-81ab-71f914de2cf0.gif)

# π”¥μ„Έλ¶€ κµ¬ν„ λ‚΄μ©
## webRTCλ¥Ό ν™μ©ν• λ‹¤μ¤‘ ν™”μƒ ν†µν™”

- `wrtc` λ¨λ“μ„ μ΄μ©ν•΄ λ‹¤μ¤‘ ν™”μƒ ν†µν™”λ¥Ό κµ¬ν„ν–μµλ‹λ‹¤.
- λ‹¤μμ μ»΄ν“¨ν„°κ°€ μ ‘μ†ν•΄λ„ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ›ν™ν μ‘λ™ν•λ„λ΅ `SFU` λ°©μ‹μ„ μ‚¬μ©ν–μµλ‹λ‹¤.
- κ° μ‚¬μ©μλ” μ„λ΅κ°€ μ„λ΅μ **Sender**μ΄μ **Receiver**μ…λ‹λ‹¤.
- λ‹¤μμ€ `SFU` λ°©μ‹μ„ κµ¬ν„ν•κΈ° μ„ν•μ—¬ μ‘μ—…ν–λ λ‹¨κ³„μ…λ‹λ‹¤.

### Roomμ— μ‚¬μ©μκ°€ λ“¤μ–΄μ¬ λ•

- ν• μ‚¬μ©μκ°€ λ“¤μ–΄μ¤λ©΄, κΈ°μ΅΄μ— λ°©μ— μλ μ‚¬μ©μλ“¤μ μ •λ³΄λ¥Ό λ‹΄μ€ κ°μ²΄ λ°°μ—΄(`allUsers`)μ„ μ‚¬μ©μμ—κ² μ „μ†΅ν•©λ‹λ‹¤.

### Senderμ Offer, Answer(`senderOffer`)

1. `Media Stream`μ„ μ„λ²„μ— λ³΄λ‚Ό ν΄λΌμ΄μ–ΈνΈ **Sender**μ™€ **μ„λ²„**κ°€ `Peer Connection`μ„ ν•μ„±ν•©λ‹λ‹¤.
2. μƒμ„±λ `Peer Connection`κ³Ό **Sender**μ `Socket ID`λ¥Ό μ €μ¥ν• κ°μ²΄λ¥Ό Receiver λ°°μ—΄(`receiverPCs`)μ— μ¶”κ°€ν•©λ‹λ‹¤.
3. `SDP(Session Description Protocol)`λ¥Ό `Answer` ν•μ‹μΌλ΅ μ”μ²­ν–λ μ‚¬μ©μμ—κ² λ°ν™ν•©λ‹λ‹¤.

### Receiverμ Offer, Answer(`receiverOffer`)

1. `Media Stream`μ„ μ„λ²„μ— λ³΄λ‚Ό ν΄λΌμ΄μ–ΈνΈ **Receiver**μ™€ **μ„λ²„**κ°€ `Peer Connection`μ„ ν•μ„±ν•©λ‹λ‹¤.
2. μƒμ„±λ `Peer Connection`κ³Ό Receiverμ `Socket ID`λ¥Ό κ°–λ” κ°μ²΄λ¥Ό Sender λ°°μ—΄(`senderPCs`)μ— μ €μ¥ν•©λ‹λ‹¤.
3. `SDP(Session Description Protocol)`μ„ `Answer` ν•μ‹μΌλ΅ μ”μ²­ν–λ μ‚¬μ©μμ—κ² λ°ν™ν•©λ‹λ‹¤.
4. μ΄ κ³Όμ •μ€ μ—¬λ¬ λ² μ‹¤ν–‰λλ©°, κΈ°μ΅΄μ— λ°©μ— μλ λ¨λ“  μ‚¬μ©μμ—κ² **Receiver**μ™€μ `Peer Connection`μ„ μ¶”κ°€ν•©λ‹λ‹¤.

### Senderμ™€ Receiverμ ICE Candidate κµν™(`senderCandidate`, `receiverCandidate`)

- P2P ν†µμ‹ μ— ν•„μ”ν• `ICE(Interactive Connectivity Establishment) Candidate`λ¥Ό μ„λ΅μ—κ² μ μ•ν•κ³  λ°›μµλ‹λ‹¤.

![webrtc](https://user-images.githubusercontent.com/43535460/182181018-99e163cf-5574-4169-be22-2d1fa2e58222.gif)

## Socket ν†µμ‹ μ„ ν™μ©ν• μ±„ν… λ° μ  κ²μ„

- μ μ €μ μ›€μ§μ„ κ³µμ , μ±„ν… κΈ°λ¥μ„ `socket.io` λΌμ΄λΈλ¬λ¦¬λ΅ κµ¬ν„ν–μµλ‹λ‹¤.
- ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² ν•΄λ‹Ή λ°μ΄ν„°λ¥Ό μ „μ†΅ν•λ©΄, μ„λ²„λ” κ·Έ roomμ— μλ” λ¨λ“  ν΄λΌμ΄μ–ΈνΈμ—κ² ν•΄λ‹Ή λ°μ΄ν„°λ¥Ό μ „μ†΅ν•λ„λ΅ κµ¬ν„ν–μµλ‹λ‹¤.

### μ‚¬μ©μ μ›€μ§μ„ μ—…λ°μ΄νΈ

1. ν΄λΌμ΄μ–ΈνΈ : μ›€μ§μ„ λ°μƒ μ‹ μ„λ²„μ—κ² λ³ΈμΈμ μ„μΉλ¥Ό μ „μ†΅ν•©λ‹λ‹¤.(`playerMovement`)
2. μ„λ²„ : `playerMovement` μ΄λ²¤νΈ μμ‹  μ‹ ν•΄λ‹Ή roomμ λ¨λ“  μ‚¬λμ—κ² λ³€κ²½λ μ„μΉλ¥Ό μ „μ†΅ν•©λ‹λ‹¤.(`updatePlayersMovement`)
3. ν΄λΌμ΄μ–ΈνΈ : `updatePlayersMovement` μ΄λ²¤νΈ μμ‹  μ‹ μ μ €μ μ„μΉ μ •λ³΄ stateλ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤.
4. ν΄λΌμ΄μ–ΈνΈ : λ¶€λ¨μ stateκ°€ μ—…λ°μ΄νΈ λμ—μΌλ―€λ΅ canvusλ¥Ό λ¦¬λ λ”λ§ ν•©λ‹λ‹¤.
    1. μ™Όμ½ λ‹¤λ¦¬λ¥Ό λ»—μ€ μ‚¬μ§„κ³Ό μ¤λ¥Έμ½ λ‹¤λ¦¬λ¥Ό λ»—μ€ μ‚¬μ§„μ„ κµμ°¨λ΅ λ³΄μ—¬μ£Όμ–΄ κ±·λ” λ¨μ…μ„ κµ¬ν„ν–μµλ‹λ‹¤.

### μ±„ν… κµ¬ν„

1. ν΄λΌμ΄μ–ΈνΈ : μ±„ν… μ μ¶ μ‹ μ„λ²„λ΅ `sendChat` μ΄λ²¤νΈλ¥Ό μ „μ†΅ν•©λ‹λ‹¤. μ‚¬μ©μμ λ‹‰λ„¤μ„κ³Ό μ±„ν… λ‚΄μ©μ΄ λ‹΄κ²¨ μμµλ‹λ‹¤.
2. μ„λ²„ : λ°›μ€ μ±„ν… λ°μ΄ν„°λ¥Ό ν•΄λ‹Ή roomμ— μλ” λ¨λ“  μ‚¬λμ—κ² `getChat` μ΄λ²¤νΈλ΅ μ „μ†΅ν•©λ‹λ‹¤.

### μ  κ²μ„ κµ¬ν„

- μ•μ„ κµ¬ν„ν• μ±„ν… κΈ°λ¥μ„ λ°”νƒ•μΌλ΅ 4κ°€μ§€ μ  κ²μ„μ„ κµ¬ν„ν–μµλ‹λ‹¤.
- μ„λ²„κ°€ μ‚¬μ©μ λ‹µλ³€μ μ •λ‹µ μ—¬λ¶€λ¥Ό κ²€μ¦ν•μ—¬ λ¨λ“  μ‚¬μ©μμ—κ² κ²°κ³Όλ¥Ό μ „μ†΅ν•©λ‹λ‹¤.
- κ²μ„μ νΉμ„±μ— λ”°λΌ κ° μ‚¬μ©μμ μ±„ν… λ‚΄μ©μ΄ κ°€λ ¤μ§ μ μμµλ‹λ‹¤.
- κ²°κ³Όκ°€ λ‚μ¤λ©΄ μμ£Όλ¥Ό κ¶μ ν•λ” μ„λ²„μ μ±„ν…μ΄ μΌμ • μ‹κ°„μ„ λ‘κ³  λ‚μµλ‹λ‹¤.
- κµ¬ν„ν• μ  κ²μ„ μΆ…λ¥λ” μ•„λμ™€ κ°™μµλ‹λ‹¤.
    - **μ§€ν•μ²  κ²μ„**
        - κ²μ„μ„ μ‹μ‘ν• μ‚¬λμ΄ μ„μΈ 1~9νΈμ„  μ¤‘ ν•λ‚λ¥Ό μ„ νƒν•©λ‹λ‹¤.
        - μ„ νƒν• νΈμ„ μ μ—­ μ΄λ¦„μ„ μμ„λ€λ΅ λ§ν•κ³ , ν‹€λ¦° μ‚¬λμ΄ μ§€λ” κ²μ„μ…λ‹λ‹¤.
        - μ„λ²„λ” μ—­ λ°μ΄ν„°λ¥Ό κ°€μ§€κ³  μμ–΄, μ‚¬μ©μμ λ‹µλ³€μ„ κ²€μ¦ν•©λ‹λ‹¤.
        
    https://user-images.githubusercontent.com/43535460/182183214-59843bde-721f-4cb5-acc9-685580be64db.mp4

    - **λ” κ²μ„ μ¤λΈ λ°μ¤**
        - κ²μ„μ΄ μ‹μ‘λλ©΄ κ°κ° ν• λ…μ„ μ§€λ©ν•©λ‹λ‹¤. μ΄λ•, μ„λ²„λ” μ±„ν…μ„ ν΄λΌμ΄μ–ΈνΈμ—κ² μ „μ†΅ν•μ§€ μ•κΈ° λ•λ¬Έμ— κ° μ‚¬μ©μλ” μ„λ΅ λ„κµ¬λ¥Ό μ§€λ©ν–λ”μ§€ μ•μ§€ λ»ν•©λ‹λ‹¤.
        - κ²μ„μ„ μ‹μ‘ν• μ‚¬λμ΄ μ«μλ¥Ό μ§€μ •ν•λ©΄ κ·Έ μ«μμ— κ±Έλ¦° μ‚¬λμ΄ μ§€λ” κ²μ„μ…λ‹λ‹¤.
        - μ„λ²„λ” κ° μ‚¬μ©μκ°€ μ§€λ©ν• λ°©ν–¥μ„ λ”°λΌκ°€λ©° λ„κ°€ κ±Έλ¦¬λ”μ§€ κ³„μ‚°ν•©λ‹λ‹¤.
    
    https://user-images.githubusercontent.com/43535460/182183713-5b2628d5-0d98-4b79-840a-542c12d9c158.mp4
    
    - **λμΉ κ²μ„**
        - κ²μ„μ΄ μ‹μ‘λλ©΄ μ‚¬μ©μλ” 1λ¶€ν„° μ«μλ¥Ό μ…λ ¥ν•©λ‹λ‹¤.
        - μ„λ²„λ” μ΄μ „μ— λ‚μ™”λ μ«μμΈμ§€, λ‚¨μ€ μ‚¬λμ΄ 1λ…μΈμ§€ μ—¬λ¶€λ¥Ό κ²€μ¦ν•μ—¬ κ° μ‚¬μ©μμ—κ² κ²°κ³Όλ¥Ό μ „μ†΅ν•©λ‹λ‹¤.
        
    https://user-images.githubusercontent.com/43535460/182184127-7c95f56c-b6ac-4c74-8916-c38d37356e40.mp4
    
    - **369 κ²μ„**
        - 1λ¶€ν„° μ«μλ¥Ό μ…λ ¥ν•κ³ , 3μ λ°°μκ°€ λ“¤μ–΄κ°„ μ«μμ—μ„λ” *μ„ μ…λ ¥ν•΄μ•Ό ν•©λ‹λ‹¤.
        - μ„λ²„λ” μ‚¬μ©μμ μμ„μ— ν•΄λ‹Ήν•λ” κ°’μ„ μ…λ ¥ν–λ”μ§€ μ—¬λ¶€λ¥Ό κ²€μ¦ν•©λ‹λ‹¤.
        
    https://user-images.githubusercontent.com/43535460/182184185-e1b8252d-c996-41f7-8fa6-67cf0ccd393d.mp4
